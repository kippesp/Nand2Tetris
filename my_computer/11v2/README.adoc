= Jack Front End Compiler (jfcl)

Nand2Tetris project #11 implementation - a Jack language compiler that converts
`.jack` files to `.vm` (virtual machine) files.  This version 11v2 is a
refactored implementation with improved AST structure and operator precedence
parsing.

== Key Improvements

- Clean AST structure suitable for multiple compilation targets
- Simplification to internal AST data structure
- Parsing with recursive descent parser
- Left-to-right expression evaluation (matches reference Jack compiler)
- Enhanced VM code generation with descriptive labels
- Comprehensive test suite with unit and integration tests
- Legacy compatibility mode for existing Jack tools

== Architecture

The compiler has three main phases:

1. **Tokenizer** - Lexical analysis of Jack source
2. **Parser** - Creates AST with configurable expression evaluation
3. **VMWriter** - Generates VM code from AST

== Usage

    jfcl -h                      # Show help
    jfcl FILENAME.jack           # Compile to .vm file
    jfcl -w FILENAME.jack        # Print VM output to console
    jfcl -p FILENAME.jack        # Show parse tree
    jfcl -t FILENAME.jack        # Show tokenizer output
    jfcl -r FILENAME.jack        # Enable operator precedence
    jfcl -l FILENAME.jack        # Left-justify VM output

== Options

    -h     Display available options
    -t     Display tokenizer output and halt
    -T     Display tokenizer output in S expression format and halt
    -p     Display parse tree output and halt
    -w     Display VM Writer output and halt
    -r     Enable operator precedence parsing
    -l     Left-justify VM output (matches reference formatting)

== Expression Parsing

By default, jfcl uses **left-to-right evaluation** to match the reference Jack
compiler:

- `1 + 2 * 3` evaluates as `(1 + 2) * 3 = 9`
- `5 - 4 + 2` evaluates as `(5 - 4) + 2 = 3`
- All operators have equal precedence and are evaluated left-to-right

=== Operator Precedence Mode

Use the `-r` flag to enable **proper operator precedence** parsing:

- `1 + 2 * 3` evaluates as `1 + (2 * 3) = 7`
- Standard mathematical precedence: `* /` before `+ -`
- Comparison operators: `< > =`
- Logical operators: `&` (AND) before `|` (OR)
- This is not tested since simulators and exiting programs don't expect it

== Legacy Compatibility

This compiler maintains compatibility with the original Nand2Tetris JVM Jack
compiler and tooling by using legacy VM generation patterns for if-statements.
This ensures compatibility with existing Jack tools and reference
implementations.

== VM Label Naming

The compiler uses descriptive label names for better readability:

**While Loops:**
- `WHILE_BEGIN_X` - Start of while loop
- `WHILE_EXIT_X` - Exit point when condition becomes false

**If Statements:**
- `IF_TRUE_X` - Jump target for true condition
- `IF_FALSE_X` - Jump target for false condition (else block)
- `IF_END_X` - End of entire if-statement

== Testing

=== Conformance Tests
Located in `conformance_tests/` directory:
- `Seven/` - Simple arithmetic test
- `HelloWorld/` - Basic program structure
- `Average/`, `ComplexArrays/`, `ConvertToBin/` - More complex tests
- `Pong/`, `Square/` - Game implementations

=== turnt Testing Tool

    turnt FILENAME.jack -p        # Print output only
    turnt FILENAME.jack --diff    # Show differences with expected
    turnt FILENAME.jack           # Run automatic comparison

== Build Information

- Built with CMake
- Uses Catch2 for unit testing
- Includes turnt for regression testing
- C++11/17 features utilized

== Implementation Details

=== Parser Improvements

The parser creates a clean AST structure where Jack language semantics are
properly represented.  Class and subroutine variable declarations are organized
under `N_CLASS_VARIABLES` and `N_LOCAL_VARIABLES` subtrees respectively.

Key improvements:
- Single `AstNode` class replacing specialized terminal/non-terminal classes
- Reduced complexity from removing excessive use of unique pointers and std::variant
- Eliminated structurally irrelevant nodes that required skipping

=== VM Writer

Re-implemented to support the redesigned AST with DFS expression parsing.  The
VM writer generates descriptive labels and maintains compatibility with legacy
Jack tools.

=== Testing

Comprehensive testing with:
- Catch2 unit tests for all code except main.cpp
- Class-level VM Writer tests
- turnt integration tests for whole-program validation

== Example Usage

=== Basic Compilation

    # Compile a Jack file to VM
    jfcl HelloWorld.jack

    # View VM output without creating file
    jfcl -w HelloWorld.jack

    # Show parse tree structure
    jfcl -p HelloWorld.jack

=== Testing with turnt

    # Run test in test directory
    turnt Main.jack

    # View test output
    turnt Main.jack -p

    # Compare with expected output
    turnt Main.jack --diff

=== Expression Evaluation Examples

    # Default left-to-right: (1 + 2) * 3 = 9
    jfcl -w test.jack

    # Operator precedence: 1 + (2 * 3) = 7 
    jfcl -r -w test.jack
